# ç”¨æˆ·ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## âœ… å·²å®ç°åŠŸèƒ½

### 1. ç”¨æˆ·æ¨¡å‹
- âœ… ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- âœ… é‚®ç®±ï¼ˆå¯é€‰ï¼Œå”¯ä¸€ï¼‰
- âœ… å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- âœ… ç”¨æˆ·çº§åˆ«ï¼šç®¡ç†å‘˜(admin)ã€VIPç”¨æˆ·(vip)ã€æ™®é€šç”¨æˆ·(user)
- âœ… è´¦æˆ·çŠ¶æ€ï¼ˆæ¿€æ´»/ç¦ç”¨ï¼‰

### 2. åç«¯API
- âœ… `/api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- âœ… `/api/v1/auth/login` - ç”¨æˆ·ç™»å½•ï¼ˆOAuth2æ ¼å¼ï¼‰
- âœ… `/api/v1/auth/login-json` - ç”¨æˆ·ç™»å½•ï¼ˆJSONæ ¼å¼ï¼Œæ–¹ä¾¿å‰ç«¯ï¼‰
- âœ… `/api/v1/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦tokenï¼‰

### 3. å‰ç«¯é¡µé¢
- âœ… `/register` - æ³¨å†Œé¡µé¢
- âœ… `/login` - ç™»å½•é¡µé¢
- âœ… é¦–é¡µæ˜¾ç¤ºç™»å½•çŠ¶æ€å’Œç”¨æˆ·ä¿¡æ¯

### 4. å®‰å…¨åŠŸèƒ½
- âœ… å¯†ç åŠ å¯†ï¼ˆbcryptï¼‰
- âœ… JWT tokenè®¤è¯
- âœ… Tokenè¿‡æœŸæ—¶é—´ï¼š30å¤©

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

åç«¯éœ€è¦å®‰è£…æ–°çš„ä¾èµ–ï¼š
```bash
docker compose exec backend pip install python-jose[cryptography] passlib[bcrypt] python-multipart
```

æˆ–è€…é‡å¯åç«¯å®¹å™¨ï¼ˆä¼šè‡ªåŠ¨å®‰è£…requirements.txtä¸­çš„æ–°ä¾èµ–ï¼‰ï¼š
```bash
docker compose restart backend
```

### 2. åˆ›å»ºæ•°æ®åº“è¡¨

```bash
docker compose exec backend python -c "
from app.core.database import engine, Base
from app.models import User
Base.metadata.create_all(bind=engine)
print('âœ… æ•°æ®åº“è¡¨å·²åˆ›å»º')
"
```

### 3. åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·

```bash
docker compose exec backend python åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·.py
```

è¿™ä¼šåˆ›å»ºï¼š
- ç®¡ç†å‘˜ï¼š`admin` / `admin123`
- VIPç”¨æˆ·ï¼š`vip` / `vip123`

### 4. æµ‹è¯•æ³¨å†Œå’Œç™»å½•

1. **è®¿é—®æ³¨å†Œé¡µé¢**ï¼šhttp://localhost:3000/register
2. **æ³¨å†Œæ–°ç”¨æˆ·**
3. **è®¿é—®ç™»å½•é¡µé¢**ï¼šhttp://localhost:3000/login
4. **ç™»å½•**

## ğŸ“ APIä½¿ç”¨ç¤ºä¾‹

### æ³¨å†Œ

```bash
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "test123"
  }'
```

### ç™»å½•

```bash
curl -X POST http://localhost:8000/api/v1/auth/login-json \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "test123"
  }'
```

è¿”å›ï¼š
```json
{
  "access_token": "eyJ...",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "user",
    "is_active": "true"
  }
}
```

### è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```bash
curl -X GET http://localhost:8000/api/v1/auth/me \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ” ç”¨æˆ·çº§åˆ«è¯´æ˜

### ç®¡ç†å‘˜ (admin)
- æ‹¥æœ‰æ‰€æœ‰æƒé™
- å¯ä»¥ç®¡ç†å…¶ä»–ç”¨æˆ·
- å¯ä»¥è®¿é—®ç®¡ç†åå°ï¼ˆå¾…å®ç°ï¼‰

### VIPç”¨æˆ· (vip)
- äº«å—VIPç‰¹æƒï¼ˆå¾…å®ç°ï¼‰
- ä¼˜å…ˆæ¨è
- ä¸“å±å®¢æœï¼ˆå¾…å®ç°ï¼‰

### æ™®é€šç”¨æˆ· (user)
- åŸºç¡€åŠŸèƒ½
- å¯ä»¥ä½¿ç”¨æ¨èå’Œæµè§ˆå•†å“

## ğŸ›¡ï¸ å®‰å…¨è¯´æ˜

1. **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨bcryptåŠ å¯†ï¼Œä¸ä¼šå­˜å‚¨æ˜æ–‡å¯†ç 
2. **JWT Token**ï¼š30å¤©æœ‰æ•ˆæœŸï¼Œå­˜å‚¨åœ¨localStorage
3. **TokenéªŒè¯**ï¼šæ¯æ¬¡è¯·æ±‚éœ€è¦æºå¸¦token
4. **CORSé…ç½®**ï¼šå·²é…ç½®å…è®¸è·¨åŸŸè¯·æ±‚

## ğŸ“± å‰ç«¯ä½¿ç”¨

### ç™»å½•çŠ¶æ€ç®¡ç†

å‰ç«¯ä½¿ç”¨localStorageå­˜å‚¨tokenå’Œç”¨æˆ·ä¿¡æ¯ï¼š

```typescript
// ç™»å½•åä¿å­˜
localStorage.setItem('token', data.access_token)
localStorage.setItem('user', JSON.stringify(data.user))

// æ£€æŸ¥ç™»å½•çŠ¶æ€
const token = localStorage.getItem('token')
const user = JSON.parse(localStorage.getItem('user') || '{}')

// é€€å‡ºç™»å½•
localStorage.removeItem('token')
localStorage.removeItem('user')
```

### è°ƒç”¨éœ€è¦è®¤è¯çš„API

```typescript
const token = localStorage.getItem('token')
const response = await fetch(`${apiUrl}/api/v1/auth/me`, {
  headers: {
    'Authorization': `Bearer ${token}`
  }
})
```

## ğŸ”§ åç»­ä¼˜åŒ–

1. **æƒé™æ§åˆ¶**ï¼šæ ¹æ®ç”¨æˆ·çº§åˆ«é™åˆ¶åŠŸèƒ½è®¿é—®
2. **ç”¨æˆ·ç®¡ç†**ï¼šç®¡ç†å‘˜å¯ä»¥ç®¡ç†ç”¨æˆ·
3. **å¯†ç é‡ç½®**ï¼šå¿˜è®°å¯†ç åŠŸèƒ½
4. **é‚®ç®±éªŒè¯**ï¼šæ³¨å†Œæ—¶éªŒè¯é‚®ç®±
5. **ä¸ªäººä¸­å¿ƒ**ï¼šç”¨æˆ·ä¿¡æ¯ç®¡ç†é¡µé¢
6. **VIPç‰¹æƒ**ï¼šVIPç”¨æˆ·ä¸“å±åŠŸèƒ½

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼š
   - ä¿®æ”¹SECRET_KEYï¼ˆåœ¨config.pyä¸­ï¼‰
   - ä½¿ç”¨HTTPS
   - è®¾ç½®æ›´çŸ­çš„tokenè¿‡æœŸæ—¶é—´

2. **å¯†ç å®‰å…¨**ï¼š
   - å»ºè®®å¯†ç è‡³å°‘8ä½
   - åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦

3. **Tokenå®‰å…¨**ï¼š
   - ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ç¡¬ç¼–ç token
   - è€ƒè™‘ä½¿ç”¨httpOnly cookieå­˜å‚¨tokenï¼ˆæ›´å®‰å…¨ï¼‰

